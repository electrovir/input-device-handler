var J=Object.defineProperty;var U=(e,t,n)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var u=(e,t,n)=>(U(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const _=[(e,t)=>t in e,(e,t)=>t in e.constructor.prototype];function X(e,t){return e?_.some(n=>{try{return n(e,t)}catch{return!1}}):!1}function Y(e){let t;try{t=Reflect.ownKeys(e)}catch{}return t??[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}var O;(function(e){e.Upper="upper",e.Lower="lower"})(O||(O={}));var P;(function(e){e.FirstThenWait="first-then-wait",e.AfterWait="after-wait"})(P||(P={}));function Q(e){return e?e instanceof Error?e.message:X(e,"message")?String(e.message):String(e):""}function A(e){return!!e&&typeof e=="object"}function ee(){return globalThis.crypto?globalThis.crypto:require("crypto").webcrypto}ee();function te(e){return e===null?"null":Array.isArray(e)?"array":typeof e}function I(e,t){return te(e)===t}class ne extends Error{constructor(t){super(`Failed to compare objects using JSON.stringify: ${t}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"JsonStringifyError"})}}function T(e,t){return JSON.stringify(e)===JSON.stringify(t)}function z(e,t){try{if(e===t||T(e,t))return!0;if(A(e)&&A(t)){const n=Object.keys(e).sort(),s=Object.keys(t).sort();if(n.length||s.length)return T(n,s)?Y(e).every(i=>z(e[i],t[i])):!1}return T(e,t)}catch(n){throw new ne(Q(n))}}const re=[(e,t)=>t in e,(e,t)=>t in e.constructor.prototype];function h(e,t){return e?re.some(n=>{try{return n(e,t)}catch{return!1}}):!1}function y(e){let t;try{t=Reflect.ownKeys(e)}catch{}return t??[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function L(e){return y(e).map(t=>e[t])}function se(e){return Object.fromEntries(e)}function ie(e,t){return e.includes(t)}function b(e){return!!e}const oe={capitalizeFirstLetter:!1};function ae(e){return e.length?e[0].toUpperCase()+e.slice(1):""}function ue(e,t){return t.capitalizeFirstLetter?ae(e):e}function ce(e,t=oe){const n=e.toLowerCase();if(!n.length)return"";const s=n.replace(/^-+/,"").replace(/-{2,}/g,"-").replace(/-(?:.|$)/g,r=>{const i=r[1];return i?i.toUpperCase():""});return ue(s,t)}var C;(function(e){e.Upper="upper",e.Lower="lower"})(C||(C={}));var M;(function(e){e.FirstThenWait="first-then-wait",e.AfterWait="after-wait"})(M||(M={}));function le(e,t){let n=!1;const s=y(e).reduce((r,i)=>{const o=t(i,e[i],e);return o instanceof Promise&&(n=!0),{...r,[i]:o}},{});return n?new Promise(async(r,i)=>{try{await Promise.all(y(s).map(async o=>{const c=await s[o];s[o]=c})),r(s)}catch(o){i(o)}}):s}function de(){return globalThis.crypto?globalThis.crypto:require("crypto").webcrypto}de();const F={gamepad1:"0",gamepad2:"1",gamepad3:"2",gamepad4:"3"};function S(e){return ie(Object.values(F),e)}const pe={mouse:"mouse",keyboard:"keyboard"},d={...pe,...F};var l=(e=>(e.Keyboard="keyboard",e.Mouse="mouse",e.Gamepad="gamepad",e))(l||{}),D=(e=>(e.Button="button",e.Axe="axe",e))(D||{});function m(e){return`button-${e}`}function K(e){return`axe-${e}`}const fe=.01;function me({value:e,gamepadDeadZone:t,globalDeadZone:n}){const s=t??(n||fe);return Math.abs(e)>s?e:0}function j({gamepadInput:e,inputIndex:t,deadZones:n,globalDeadZone:s}){const r=I(e,"number"),i=r?K(t):m(t),o=r?e:e.value;return{inputName:i,value:me({value:o,gamepadDeadZone:n[i],globalDeadZone:s}),inputType:r?D.Axe:D.Button}}function ye({gamepad:e,deadZoneSettings:t,globalDeadZone:n}){const s=String(e.index);if(!S(s))throw new Error(`Tried to serialize gamepad with out-of-bounds index: '${e.index}'`);const r=t[e.id]||{},i=e.axes.map((a,p)=>j({gamepadInput:a,inputIndex:p,deadZones:r,globalDeadZone:n})),o=e.buttons.map((a,p)=>j({deadZones:r,gamepadInput:a,globalDeadZone:n,inputIndex:p})),c=se([...o,...i].map(a=>[a.inputName,a]));return{axes:i,buttons:o,isConnected:e.connected,gamepadName:e.id,deviceKey:s,mapping:e.mapping,serialized:!0,timestamp:e.timestamp,inputsByName:c}}const v=window.navigator;function ve({deadZoneSettings:e,globalDeadZone:t}){return Array.from(h(v,"webkitGetGamepads")?v.webkitGetGamepads():h(v,"getGamepads")?v.getGamepads():[]).filter(n=>!!n).map(n=>ye({gamepad:n,deadZoneSettings:e,globalDeadZone:t}))}function ge({deadZoneSettings:e,globalDeadZone:t}){return ve({deadZoneSettings:e,globalDeadZone:t}).reduce((r,i)=>{const o=i.deviceKey;return S(o)?(r[o]=i,r):(console.warn(`ignoring gamepad index '${o}'`),r)},{})}function he(e){const t={},n={deviceKey:e.deviceKey,deviceName:e.gamepadName,deviceType:l.Gamepad};return Object.values(e.inputsByName).forEach(s=>{s.value&&(t[s.inputName]={...n,details:s,inputName:s.inputName,inputValue:s.value})}),t}function be(e){return le(e,(t,n)=>({currentInputs:he(n),deviceDetails:n,deviceName:n.gamepadName,deviceKey:n.deviceKey,deviceType:l.Gamepad}))}function x(e){return L(e).map(s=>s==null?void 0:s.currentInputs).filter(b).map(s=>L(s)).flat()}var we=globalThis&&globalThis.__setFunctionName||function(e,t,n){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};function Ne(){return class extends Event{constructor(t,n){super(t,n),Object.defineProperty(this,"detail",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.detail=n.detail}}}const Te=globalThis.CustomEvent||Ne();function Ie(){function e(t){var n;return n=class extends Te{constructor(r){super(t,r)}},we(n,"TypedEventConstructor"),Object.defineProperty(n,"type",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return e}globalThis&&globalThis.__setFunctionName;function Le(e){let t;try{t=Reflect.ownKeys(e)}catch{}return t??[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function G(e){return Le(e).map(t=>e[t])}var Z;(function(e){e.Upper="upper",e.Lower="lower"})(Z||(Z={}));var R;(function(e){e.FirstThenWait="first-then-wait",e.AfterWait="after-wait"})(R||(R={}));function De(){return globalThis.crypto?globalThis.crypto:require("crypto").webcrypto}De();class Ke{constructor(){Object.defineProperty(this,"listeners",{enumerable:!0,configurable:!0,writable:!0,value:{}})}getListenerCount(){return G(this.listeners).map(n=>(n==null?void 0:n.size)||0).reduce((n,s)=>n+s,0)}listen(t,n,s={}){const r=this.listeners,i=I(t,"string")?t:t.type;function o(){var a;return((a=r[i])==null?void 0:a.delete(n))||!1}function c(a,p){s.once&&o(),n(a,p)}return r[i]||(r[i]=new Map),r[i].set(n,{listener:c,removeListener:o}),o}removeListener(t,n){const s=I(t,"string")?t:t.type,r=this.listeners[s];if(!r)return!1;const i=r.get(n);return i?i.removeListener():!1}dispatch(t){const n=this.listeners[t.type],s=(n==null?void 0:n.size)||0;return n==null||n.forEach(r=>{r.listener(t,r.removeListener)}),s}removeAllListeners(){const n=G(this.listeners).reduce((s,r)=>{const i=(r==null?void 0:r.size)||0;return r==null||r.clear(),s+i},0);return this.listeners={},n}destroy(){this.removeAllListeners()}}function Ee(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function f(e,t,n){return Ee(globalThis,e,t,n)}function w(){return(e,t)=>{var r;const n=ce(e,{capitalizeFirstLetter:!0}),s=(r=class extends Ie()(e){constructor(){super(...arguments);u(this,"eventType",e)}static constructIfDataIsNew(o,...c){const a=s.getNewData(...c);if(a)return new s({detail:{timestamp:o,inputs:a}})}},u(r,"getNewData",t),r);return Object.defineProperty(s,"name",{value:n,writable:!0}),s}}function V(e,t){return e.deviceKey===t.deviceKey&&e.inputName===t.inputName&&e.inputName===t.inputName&&e.inputValue===t.inputValue}function Oe(...[e,t]){const n=x(t),s=e?x(e):[];if(!z(s,n)){const r=n.filter(o=>!s.find(c=>V(c,o))),i=s.filter(o=>!n.find(c=>V(c,o)));return{newInputs:r,removedInputs:i,allCurrentInputs:n}}}const q=w()("current-inputs-changed",Oe);function Pe(...[e,t]){if(!e)return[];const n=y(e).filter(s=>!h(t,s));if(n.length)return n.map(s=>e[s]).filter(b)}const B=w()("devices-removed",Pe);function Ae(...[e,t]){if(!e)return L(t).filter(b);const n=y(t).filter(s=>!h(e,s));if(n.length)return n.map(s=>t[s]).filter(b)}const W=w()("new-devices-added",Ae),$={deviceDetails:void 0,deviceKey:d.keyboard,deviceName:"keyboard",deviceType:l.Keyboard},g={deviceDetails:void 0,deviceKey:d.mouse,deviceName:"mouse",deviceType:l.Mouse};function Ce(...[e,t]){return t}const Me=w()("all-devices-updated",Ce),H=[Me,W,B,q];Object.fromEntries(H.map(e=>[e.type,e]));const k="code";class je extends Ke{constructor(n={}){super();u(this,"currentKeyboardInputs",{});u(this,"currentMouseInputs",{});u(this,"gamepadDeadZoneSettings",{});u(this,"lastReadInputDevices");u(this,"loopIsRunning",!1);u(this,"globalDeadZone",0);u(this,"removeGlobalListeners",()=>{});u(this,"currentLoopIndex",-1);u(this,"lastEventDetails",{});n.gamepadDeadZoneSettings&&this.updateGamepadDeadZoneSettings(n.gamepadDeadZoneSettings),n.globalDeadZone&&(this.globalDeadZone=n.globalDeadZone),this.attachWindowListeners(n),this.readAllDevices(),n.startLoopImmediately&&this.startPollingLoop()}attachWindowListeners(n){const s=[f("keydown",r=>{const i=m(r[k]);if(this.currentKeyboardInputs.hasOwnProperty(i))return;const o={deviceType:l.Keyboard,details:{keyboardEvent:r},deviceKey:d.keyboard,deviceName:$.deviceName,inputName:i,inputValue:1};this.currentKeyboardInputs[i]=o}),f("keyup",r=>{delete this.currentKeyboardInputs[m(r[k])]}),f("mousedown",r=>{const i=m(r.button);this.currentMouseInputs.hasOwnProperty(i)||(this.currentMouseInputs[i]={deviceType:l.Mouse,details:{mouseEvent:r},deviceName:g.deviceName,deviceKey:d.mouse,inputName:i,inputValue:1})}),f("mouseup",r=>{delete this.currentMouseInputs[m(r.button)]}),n.disableMouseMovement?void 0:f("mousemove",r=>{const i=K("x"),o=K("y");this.currentMouseInputs[i]={deviceType:l.Mouse,details:{mouseEvent:r},deviceName:g.deviceName,deviceKey:d.mouse,inputName:i,inputValue:r.clientX},this.currentMouseInputs[o]={deviceType:l.Mouse,details:{mouseEvent:r},deviceName:g.deviceName,deviceKey:d.mouse,inputName:o,inputValue:r.clientY}})];this.removeGlobalListeners=()=>{s.forEach(r=>r==null?void 0:r())}}runPollingLoop(n,s){this.loopIsRunning&&this.currentLoopIndex===n&&(this.readAllDevices(this.gamepadDeadZoneSettings,s),requestAnimationFrame(r=>{this.runPollingLoop(n,r)}))}fireEvents(n,s,r){H.forEach(i=>{const o=i.constructIfDataIsNew(n,s,r);o&&(this.lastEventDetails[o.type]={constructor:i,constructorInputs:[n,s,r]},this.dispatch(o))})}getCurrentDeviceValues(n,s){const r=ge({deadZoneSettings:n,globalDeadZone:s}),i=be(r);return{[d.keyboard]:{...$,currentInputs:{...this.currentKeyboardInputs}},[d.mouse]:{...g,currentInputs:{...this.currentMouseInputs}},...i}}startPollingLoop(){this.loopIsRunning||(this.loopIsRunning=!0,this.currentLoopIndex++,requestAnimationFrame(n=>{this.runPollingLoop(this.currentLoopIndex,n)}))}pausePollingLoop(){this.loopIsRunning&&(this.loopIsRunning=!1)}getLastPollResults(){return this.lastReadInputDevices}readAllDevices(n=this.gamepadDeadZoneSettings,s=performance.now(),r=this.globalDeadZone){const i=this.getCurrentDeviceValues(n,r),o=this.lastReadInputDevices;return this.lastReadInputDevices=i,this.fireEvents(s,o,i),i}updateGamepadDeadZoneSettings(n){this.gamepadDeadZoneSettings=n}}const N=new je({startLoopImmediately:!0}),E=window.document.getElementById("device-names");N.listen(q,e=>{console.info("input changed:",e.detail.inputs)});N.listen(B,e=>{console.info("devices removed:",e.detail.inputs),e.detail.inputs.forEach(t=>{E.innerHTML=E.innerHTML.replace(String(t.deviceName)+"<br>","")})});N.listen(W,e=>{console.info("new devices:",e.detail.inputs),e.detail.inputs.forEach(t=>{E.innerHTML+=String(t.deviceName)+"<br>"})});console.info({instance:N});
