var k=Object.defineProperty;var z=(e,t,n)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var d=(e,t,n)=>(z(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var p=(e=>(e.NewDevicesAdded="new-devices-added",e.AllDevicesUpdated="all-devices-updated",e.CurrentInputsChanged="current-inputs-updated",e.DevicesRemoved="devices-removed",e))(p||{}),F=globalThis&&globalThis.__setFunctionName||function(e,t,n){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};function S(){return class extends Event{constructor(t,n){super(t,n),Object.defineProperty(this,"detail",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.detail=n.detail}}}const q=globalThis.CustomEvent||S();function B(){function e(t){var n;return n=class extends q{constructor(s){super(t,s)}},F(n,"TypedEventConstructor"),Object.defineProperty(n,"type",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return e}globalThis&&globalThis.__setFunctionName;const J=[(e,t)=>t in e,(e,t)=>t in e.constructor.prototype];function v(e,t){return e?J.some(n=>{try{return n(e,t)}catch{return!1}}):!1}function f(e){let t;try{t=Reflect.ownKeys(e)}catch{}return t??[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function y(e){return f(e).map(t=>e[t])}function U(e){return Object.fromEntries(e)}function b(e){return!!e}const _={capitalizeFirstLetter:!1};function $(e){return e.length?e[0].toUpperCase()+e.slice(1):""}function W(e,t){return t.capitalizeFirstLetter?$(e):e}function H(e,t=_){const n=e.toLowerCase();if(!n.length)return"";const r=n.replace(/^-+/,"").replace(/-{2,}/g,"-").replace(/-(?:.|$)/g,s=>{const i=s[1];return i?i.toUpperCase():""});return W(r,t)}var K;(function(e){e.Upper="upper",e.Lower="lower"})(K||(K={}));var x;(function(e){e.FirstThenWait="first-then-wait",e.AfterWait="after-wait"})(x||(x={}));function X(e){return e?e instanceof Error?e.message:v(e,"message")?String(e.message):String(e):""}function Y(e){return Array.isArray(e)?"array":typeof e}function I(e,t){return Y(e)===t}class Q extends Error{constructor(t){super(`Failed to compare objects using JSON.stringify: ${t}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"JsonStringifyError"})}}function D(e,t){return JSON.stringify(e)===JSON.stringify(t)}function G(e,t){try{return e===t||D(e,t)?!0:A(e)&&A(t)?D(Object.keys(e).sort(),Object.keys(t).sort())?f(e).every(r=>G(e[r],t[r])):!1:D(e,t)}catch(n){throw new Q(X(n))}}function A(e){return!!e&&typeof e=="object"}function ee(e,t){let n=!1;const r=f(e).reduce((s,i)=>{const o=t(i,e[i],e);return o instanceof Promise&&(n=!0),{...s,[i]:o}},{});return n?new Promise(async(s,i)=>{try{await Promise.all(f(r).map(async o=>{const a=await r[o];r[o]=a})),s(r)}catch(o){i(o)}}):r}function te(){return globalThis.crypto?globalThis.crypto:require("crypto").webcrypto}te();class ne{constructor(){Object.defineProperty(this,"listeners",{enumerable:!0,configurable:!0,writable:!0,value:{}})}getListenerCount(){return y(this.listeners).map(n=>(n==null?void 0:n.size)||0).reduce((n,r)=>n+r,0)}listen(t,n,r={}){const s=this.listeners,i=I(t,"string")?t:t.type;function o(){var c;return((c=s[i])==null?void 0:c.delete(n))||!1}function a(c,C){r.once&&o(),n(c,C)}return s[i]||(s[i]=new Map),s[i].set(n,{listener:a,removeListener:o}),o}removeListener(t,n){const r=I(t,"string")?t:t.type,s=this.listeners[r];if(!s)return!1;const i=s.get(n);return i?i.removeListener():!1}dispatch(t){const n=this.listeners[t.type],r=(n==null?void 0:n.size)||0;return n==null||n.forEach(s=>{s.listener(t,s.removeListener)}),r}removeAllListeners(){const n=y(this.listeners).reduce((r,s)=>{const i=(s==null?void 0:s.size)||0;return s==null||s.clear(),r+i},0);return this.listeners={},n}destroy(){this.removeAllListeners()}}var u=(e=>(e.Keyboard="keyboard",e.Mouse="mouse",e.Gamepad="gamepad",e))(u||{});const R={gamepad1:0,gamepad2:1,gamepad3:2,gamepad4:3};function Z(e){return Object.values(R).includes(e)}const re={mouse:"mouse",keyboard:"keyboard"},l={...re,...R};u.Gamepad,u.Gamepad,u.Gamepad,u.Gamepad,u.Keyboard,u.Mouse;const se=.01;function ie({value:e,gamepadDeadZone:t,globalDeadZone:n}){const r=t??(n||se);return Math.abs(e)>r?e:0}var L=(e=>(e.Button="button",e.Axe="axe",e))(L||{});function m(e){return`button-${e}`}function T(e){return`axe-${e}`}function P({gamepadInput:e,inputIndex:t,deadZones:n,globalDeadZone:r}){const s=I(e,"number"),i=s?T(t):m(t),o=s?e:e.value;return{inputName:i,value:ie({value:o,gamepadDeadZone:n[i],globalDeadZone:r}),inputType:s?L.Axe:L.Button}}function oe({gamepad:e,deadZoneSettings:t,globalDeadZone:n}){if(!Z(e.index))throw new Error(`Tried to serialize gamepad with out-of-bounds index: '${e.index}'`);const r=t[e.id]||{},s=e.axes.map((a,c)=>P({gamepadInput:a,inputIndex:c,deadZones:r,globalDeadZone:n})),i=e.buttons.map((a,c)=>P({deadZones:r,gamepadInput:a,globalDeadZone:n,inputIndex:c})),o=U([...i,...s].map(a=>[a.inputName,a]));return{axes:s,buttons:i,isConnected:e.connected,gamepadName:e.id,index:e.index,mapping:e.mapping,serialized:!0,timestamp:e.timestamp,inputsByName:o}}const g=window.navigator;function ae({deadZoneSettings:e,globalDeadZone:t}){return Array.from(v(g,"webkitGetGamepads")?g.webkitGetGamepads():v(g,"getGamepads")?g.getGamepads():[]).filter(n=>!!n).map(n=>oe({gamepad:n,deadZoneSettings:e,globalDeadZone:t}))}function ue({deadZoneSettings:e,globalDeadZone:t}){return ae({deadZoneSettings:e,globalDeadZone:t}).reduce((s,i)=>{const o=i.index;return Z(o)?(s[o]=i,s):(console.warn(`ignoring gamepad index '${o}'`),s)},{})}function ce(e){const t={},n={deviceKey:e.index,deviceName:e.gamepadName,deviceType:u.Gamepad};return Object.values(e.inputsByName).forEach(r=>{r.value&&(t[r.inputName]={...n,details:r,inputName:r.inputName,inputValue:r.value})}),t}function de(e){return ee(e,(t,n)=>({currentInputs:ce(n),deviceDetails:n,deviceName:n.gamepadName,deviceKey:n.index,deviceType:u.Gamepad}))}function M(e){return y(e).map(r=>r==null?void 0:r.currentInputs).filter(b).map(r=>y(r)).flat()}const O={deviceDetails:void 0,deviceKey:l.keyboard,deviceName:"keyboard",deviceType:u.Keyboard},h={deviceDetails:void 0,deviceKey:l.mouse,deviceName:"mouse",deviceType:u.Mouse};function w(){return(e,t)=>{var s;const n=H(e,{capitalizeFirstLetter:!0}),r=(s=class extends B()(e){constructor(){super(...arguments);d(this,"eventType",e)}static constructIfDataIsNew(o,...a){const c=r.getNewData(...a);if(c)return new r({detail:{timestamp:o,inputs:c}})}},d(s,"getNewData",t),s);return Object.defineProperty(r,"name",{value:n,writable:!0}),r}}function le(...[e,t]){return t}const pe=w()(p.AllDevicesUpdated,le);function j(e,t){return e.deviceKey===t.deviceKey&&e.inputName===t.inputName&&e.inputName===t.inputName&&e.inputValue===t.inputValue}function fe(...[e,t]){const n=M(t),r=e?M(e):[];if(!G(r,n)){const s=n.filter(o=>!r.find(a=>j(a,o))),i=r.filter(o=>!n.find(a=>j(a,o)));return{newInputs:s,removedInputs:i,allCurrentInputs:n}}}const me=w()(p.CurrentInputsChanged,fe);function ve(...[e,t]){if(!e)return[];const n=f(e).filter(r=>!v(t,r));if(n.length)return n.map(r=>e[r]).filter(b)}const ye=w()(p.DevicesRemoved,ve);function ge(...[e,t]){if(!e)return y(t).filter(b);const n=f(t).filter(r=>!v(e,r));if(n.length)return n.map(r=>t[r]).filter(b)}const he=w()(p.NewDevicesAdded,ge),V=[pe,he,ye,me];Object.fromEntries(V.map(e=>[e.type,e]));class be extends ne{constructor(n={}){super();d(this,"currentKeyboardInputs",{});d(this,"currentMouseInputs",{});d(this,"gamepadDeadZoneSettings",{});d(this,"lastReadInputDevices");d(this,"loopIsRunning",!1);d(this,"globalDeadZone",0);d(this,"currentLoopIndex",-1);d(this,"lastEventDetails",{});n.gamepadDeadZoneSettings&&this.updateGamepadDeadZoneSettings(n.gamepadDeadZoneSettings),n.globalDeadZone&&(this.globalDeadZone=n.globalDeadZone),this.attachWindowListeners(n),this.readAllDevices(),n.startLoopImmediately&&this.startPollingLoop()}attachWindowListeners(n){window.addEventListener("keydown",r=>{const s=m(r.key);if(this.currentKeyboardInputs.hasOwnProperty(s))return;const i={deviceType:u.Keyboard,details:{keyboardEvent:r},deviceKey:l.keyboard,deviceName:O.deviceName,inputName:s,inputValue:1};this.currentKeyboardInputs[s]=i}),window.addEventListener("keyup",r=>{delete this.currentKeyboardInputs[m(r.key)]}),window.addEventListener("mousedown",r=>{const s=m(r.button);this.currentMouseInputs.hasOwnProperty(s)||(this.currentMouseInputs[s]={deviceType:u.Mouse,details:{mouseEvent:r},deviceName:h.deviceName,deviceKey:l.mouse,inputName:s,inputValue:1})}),window.addEventListener("mouseup",r=>{delete this.currentMouseInputs[m(r.button)]}),n.disableMouseMovement||window.addEventListener("mousemove",r=>{const s=T("x"),i=T("y");this.currentMouseInputs[s]={deviceType:u.Mouse,details:{mouseEvent:r},deviceName:h.deviceName,deviceKey:l.mouse,inputName:s,inputValue:r.clientX},this.currentMouseInputs[i]={deviceType:u.Mouse,details:{mouseEvent:r},deviceName:h.deviceName,deviceKey:l.mouse,inputName:i,inputValue:r.clientY}})}runPollingLoop(n,r){this.loopIsRunning&&this.currentLoopIndex===n&&(this.readAllDevices(this.gamepadDeadZoneSettings,r),requestAnimationFrame(s=>{this.runPollingLoop(n,s)}))}fireEvents(n,r,s){V.forEach(i=>{const o=i.constructIfDataIsNew(n,r,s);o&&(this.lastEventDetails[o.type]={constructor:i,constructorInputs:[n,r,s]},this.dispatch(o))})}getCurrentDeviceValues(n,r){const s=ue({deadZoneSettings:n,globalDeadZone:r}),i=de(s);return{[l.keyboard]:{...O,currentInputs:{...this.currentKeyboardInputs}},[l.mouse]:{...h,currentInputs:{...this.currentMouseInputs}},...i}}startPollingLoop(){this.loopIsRunning||(this.loopIsRunning=!0,this.currentLoopIndex++,requestAnimationFrame(n=>{this.runPollingLoop(this.currentLoopIndex,n)}))}pausePollingLoop(){this.loopIsRunning&&(this.loopIsRunning=!1)}getLastPollResults(){return this.lastReadInputDevices}readAllDevices(n=this.gamepadDeadZoneSettings,r=performance.now(),s=this.globalDeadZone){const i=this.getCurrentDeviceValues(n,s),o=this.lastReadInputDevices;return this.lastReadInputDevices=i,this.fireEvents(r,o,i),i}updateGamepadDeadZoneSettings(n){this.gamepadDeadZoneSettings=n}}const N=new be({startLoopImmediately:!0}),E=window.document.getElementById("device-names");N.listen(p.CurrentInputsChanged,e=>{console.info("input changed:",e.detail.inputs)});N.listen(p.DevicesRemoved,e=>{console.info("devices removed:",e.detail.inputs),e.detail.inputs.forEach(t=>{E.innerHTML=E.innerHTML.replace(String(t.deviceName)+"<br>","")})});N.listen(p.NewDevicesAdded,e=>{console.info("new devices:",e.detail.inputs),e.detail.inputs.forEach(t=>{E.innerHTML+=String(t.deviceName)+"<br>"})});console.info({instance:N});
