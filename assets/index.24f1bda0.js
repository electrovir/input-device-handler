(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();var u=(e=>(e.NewDevicesAdded="new-devices-added",e.AllDevicesUpdated="all-devices-updated",e.CurrentInputsChanged="current-inputs-updated",e.DevicesRemoved="devices-removed",e))(u||{});function C(){return e=>{var t;return t=class extends CustomEvent{constructor(s){super(e,s)}},t.type=e,t}}class N extends EventTarget{addEventListener(t,n,s){return super.addEventListener(t,n,s)}dispatchEvent(t){return super.dispatchEvent(t)}removeEventListener(t,n,s){return super.removeEventListener(t,n,s)}}const k=["january","february","march","april","may","june","july","august","september","october","november","december"];k.map(e=>e.slice(0,3));function E(e){return!!e}function c(e){return Reflect.ownKeys(e)}function f(e){return c(e).map(t=>e[t])}function g(e,t){return e&&Reflect.has(e,t)}function D(e){return Object.entries(e).sort((t,n)=>t[0].localeCompare(n[0]))}function M(e,t){try{const n=D(e),s=D(t);return JSON.stringify(n)===JSON.stringify(s)}catch(n){throw console.error("Failed to compare objects using JSON.stringify"),n}}function A(e,t){let n=!1;const s=c(e).reduce((r,a)=>{const i=t(a,e[a]);return i instanceof Promise&&(n=!0),{...r,[a]:i}},{});return n?new Promise(async(r,a)=>{try{await Promise.all(c(s).map(async i=>{const o=await s[i];s[i]=o})),r(s)}catch(i){a(i)}}):s}var m=(e=>(e.Button="button",e.Axe="axe",e))(m||{}),d=(e=>(e.Keyboard="keyboard",e.Mouse="mouse",e.Gamepad="gamepad",e))(d||{});function P(e){return`button-${e}`}function S(e){return`axe-${e}`}function T(){return window.navigator}function R(e){return{pressed:e.pressed,touched:e.touched,value:e.value}}function O(e){return{axes:e.axes,buttons:e.buttons.map(R),connected:e.connected,id:e.id,index:e.index,mapping:e.mapping,serialized:!0,timestamp:e.timestamp}}function K(e){const t=T();return Array.from(g(t,"webkitGetGamepads")?t.webkitGetGamepads():t.getGamepads()).filter(r=>!!r).map(r=>O(r)).reduce((r,a)=>{const i=G(a,e);return r[a.index]={...a,...i},r},{})}function Z(e){const t={},n={deviceIndex:e.index,deviceName:e.id,deviceType:d.Gamepad};return e.buttons.forEach((s,r)=>{if(s.value){const a=P(r);t[a]={...n,details:{inputType:m.Button,buttonDetails:s},inputName:a,value:s.value}}}),e.axes.forEach((s,r)=>{if(s){const a=S(r);t[a]={...n,details:{inputType:m.Axe},deviceIndex:e.index,inputName:a,value:s}}}),t}const w=.01;function G(e,t){const n=t[e.id],s=e.axes.map((a,i)=>{var l;const o=(l=n==null?void 0:n.axesDeadZones[i])!=null?l:w;return Math.abs(a)<o?0:a}),r=e.buttons.map((a,i)=>{var I;const o=(I=n==null?void 0:n.axesDeadZones[i])!=null?I:w,l=Math.abs(a.value)<o?0:a.value;return{...a,value:l}});return{axes:s,buttons:r}}function B(e){return A(e,(t,n)=>({currentInputs:Z(n),deviceDetails:n,name:n.id,index:n.index,type:d.Gamepad}))}function x(e){return f(e).map(s=>s.currentInputs).map(s=>f(s)).flat()}const h=Symbol("keyboard device id"),y=Symbol("mouse device id"),V={deviceDetails:void 0,index:-1,name:h,type:d.Keyboard},j={deviceDetails:void 0,index:-1,name:y,type:d.Mouse};function p(){return(e,t)=>{var n;const s=(n=class extends C()(e){static constructIfDataDataCheckPasses(r,...a){const i=s.dataCheckCallback(...a);if(i)return new s({detail:{timestamp:r,data:i}})}},n.dataCheckCallback=t,n);return s}}function z(...[e,t]){return t}class F extends p()(u.AllDevicesUpdated,z){}function q(...[e,t]){const n=x(t),s=e?x(e):[];if(!M(s,n)){const r=n.filter(i=>!s.find(o=>{o.inputName,i.inputName})),a=s.filter(i=>!n.find(o=>{o.inputName,i.inputName}));return{newInputs:r,removedInputs:a,allCurrentInputs:n}}}class J extends p()(u.CurrentInputsChanged,q){}function U(...[e,t]){if(!e)return[];const n=c(e).filter(s=>!g(t,s));if(n.length)return n.map(s=>e[s]).filter(E)}class H extends p()(u.DevicesRemoved,U){}function W(...[e,t]){if(!e)return f(t);const n=c(t).filter(s=>!g(e,s));if(n.length)return n.map(s=>t[s]).filter(E)}class _ extends p()(u.NewDevicesAdded,W){}const L=[F,_,H,J];L.reduce((e,t)=>(e[t.type]=t,e),{});class $ extends N{constructor(t={}){super(),this.currentKeyboardInputs={},this.currentMouseInputs={},this.gamepadDeadZoneSettings={},this.loopIsRunning=!1,this.currentLoopIndex=-1,t.skipLoopStart||this.startPollingLoop(),t.gamepadDeadZoneSettings&&this.updateGamepadDeadZoneSettings(t.gamepadDeadZoneSettings),this.attachWindowListeners()}attachWindowListeners(){window.addEventListener("keydown",t=>{const n=t.key;this.currentKeyboardInputs.hasOwnProperty(n)||(this.currentKeyboardInputs[n]={deviceType:d.Keyboard,details:{keyboardEvent:t},deviceName:h,deviceIndex:-1,inputName:n,value:1})}),window.addEventListener("keyup",t=>{delete this.currentKeyboardInputs[t.key]}),window.addEventListener("mousedown",t=>{const n=t.button;this.currentMouseInputs.hasOwnProperty(n)||(this.currentMouseInputs[n]={deviceType:d.Mouse,details:{mouseEvent:t},deviceName:y,deviceIndex:-1,inputName:n,value:1})}),window.addEventListener("mouseup",t=>{delete this.currentMouseInputs[t.button]})}runPollingLoop(t,n){this.loopIsRunning&&this.currentLoopIndex===t&&(this.updateInputDevices(n),requestAnimationFrame(s=>{this.runPollingLoop(t,s)}))}fireEvents(t,n){L.forEach(s=>{const r=s.constructIfDataDataCheckPasses(t,this.lastReadInputDevices,n);r&&this.dispatchEvent(r)})}readAllInputDevices(){const t=K(this.gamepadDeadZoneSettings),n=B(t);return{[h]:{...V,currentInputs:{...this.currentKeyboardInputs}},[y]:{...j,currentInputs:{...this.currentMouseInputs}},...n}}startPollingLoop(){this.loopIsRunning=!0,this.currentLoopIndex++,requestAnimationFrame(t=>{this.runPollingLoop(this.currentLoopIndex,t)})}pausePollingLoop(){this.loopIsRunning=!1}getLastPollResults(){return this.lastReadInputDevices}updateInputDevices(t=Date.now()){const n=this.readAllInputDevices();return this.fireEvents(t,n),this.lastReadInputDevices=n,n}updateGamepadDeadZoneSettings(t){this.gamepadDeadZoneSettings=t}}const v=new $,b=window.document.getElementById("device-names");v.addEventListener(u.CurrentInputsChanged,e=>{console.info("input changed:",e.detail.data)});v.addEventListener(u.DevicesRemoved,e=>{console.info("devices removed:",e.detail.data),e.detail.data.forEach(t=>{b.innerHTML=b.innerHTML.replace(String(t.name)+"<br>","")})});v.addEventListener(u.NewDevicesAdded,e=>{console.info("new devices:",e.detail.data),e.detail.data.forEach(t=>{b.innerHTML+=String(t.name)+"<br>"})});console.info({instance:v});
