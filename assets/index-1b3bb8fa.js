(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var d=(e=>(e.NewDevicesAdded="new-devices-added",e.AllDevicesUpdated="all-devices-updated",e.CurrentInputsChanged="current-inputs-updated",e.DevicesRemoved="devices-removed",e))(d||{}),O=globalThis&&globalThis.__setFunctionName||function(e,t,n){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};function R(){return e=>{var t;return t=class extends CustomEvent{constructor(s){super(e,s)}},O(t,"TypedEventConstructor"),t.type=e,t}}globalThis&&globalThis.__setFunctionName;function V(e,t){return e.filter((n,s)=>!t.includes(s))}function j(e){return e?e instanceof Error?e.message:v(e,"message")?String(e.message):String(e):""}function G(e){return e instanceof Error?e:new Error(j(e))}function M(e){return!!e}function I(e){return!!e&&typeof e=="object"}const S=[(e,t)=>t in e,(e,t)=>t in e.constructor.prototype];function v(e,t){return e?S.some(n=>{try{return n(e,t)}catch{return!1}}):!1}function p(e){let t;try{t=Reflect.ownKeys(e)}catch{}return t??[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function y(e){return p(e).map(t=>e[t])}function D({source:e,whitespace:t,errorHandler:n}){try{return JSON.stringify(e,void 0,t)}catch(s){if(n)return n(s);throw s}}const L="Failed to compare objects using JSON.stringify";function N(e,t,n){return D({source:e,errorHandler(s){if(n)return"";throw s}})===D({source:t,errorHandler(s){if(n)return"";throw s}})}function K(e,t,n={}){try{return e===t?!0:I(e)&&I(t)?N(Object.keys(e).sort(),Object.keys(t).sort(),!!(n!=null&&n.ignoreNonSerializableProperties))?Object.keys(e).every(r=>K(e[r],t[r])):!1:N(e,t,!!(n!=null&&n.ignoreNonSerializableProperties))}catch(s){const r=G(s);throw r.message.startsWith(L)||(r.message=`${L}: ${r.message}`),r}}function Z(e,t){let n=!1;const s=p(e).reduce((r,i)=>{const a=t(i,e[i],e);return a instanceof Promise&&(n=!0),{...r,[i]:a}},{});return n?new Promise(async(r,i)=>{try{await Promise.all(p(s).map(async a=>{const o=await s[a];s[a]=o})),r(s)}catch(a){i(a)}}):s}class F extends EventTarget{constructor(){super(...arguments),this.setupListeners=[]}getListenerCount(){return this.setupListeners.length}addEventListener(t,n,s){super.addEventListener(t,n,s),n&&this.setupListeners.push({type:t,callback:n,options:s})}dispatchEvent(t){return super.dispatchEvent(t)}removeEventListener(t,n,s){super.removeEventListener(t,n,s);const r=this.setupListeners.findIndex(i=>{if(i.type!==t)return!1;if(typeof s<"u"||typeof i.options<"u"){if(typeof s!=typeof i.options||typeof i.options=="boolean"&&typeof s=="boolean"&&s!==i.options)return!1;if(typeof i.options=="object"&&typeof s=="object"&&s.capture!==i.options.capture)return!1}return i.callback===n});this.setupListeners=V(this.setupListeners,[r])}removeAllEventListeners(){this.setupListeners.forEach(t=>{super.removeEventListener(t.type,t.callback,t.options)}),this.setupListeners=[]}}const T={gamepad1:0,gamepad2:1,gamepad3:2,gamepad4:3};function k(e){return Object.values(T).includes(e)}const _={mouse:"mouse",keyboard:"keyboard"},c={..._,...T};var u=(e=>(e.Keyboard="keyboard",e.Mouse="mouse",e.Gamepad="gamepad",e))(u||{}),g=(e=>(e.Button="button",e.Axe="axe",e))(g||{});function l(e){return`button-${e}`}function b(e){return`axe-${e}`}function q(e){return{pressed:e.pressed,touched:e.touched,value:e.value}}function z(e){if(!k(e.index))throw new Error(`Tried to serialize gamepad with out-of-bounds index: '${e.index}'`);return{axes:e.axes,buttons:e.buttons.map(q),connected:e.connected,id:e.id,index:e.index,mapping:e.mapping,serialized:!0,timestamp:e.timestamp}}function J(){return window.navigator}function B(e){const t=J();return Array.from(v(t,"webkitGetGamepads")?t.webkitGetGamepads():t.getGamepads()).filter(r=>!!r).map(r=>z(r)).reduce((r,i)=>{const a=H(i,e),o=i.index;return k(o)?(r[o]={...i,...a},r):(console.warn(`ignoring gamepad index '${o}'`),r)},{})}function $(e){const t={},n={deviceKey:e.index,deviceName:e.id,deviceType:u.Gamepad};return e.buttons.forEach((s,r)=>{if(s.value){const i=l(r);t[i]={...n,details:{inputType:g.Button,buttonDetails:s},inputName:i,inputValue:s.value}}}),e.axes.forEach((s,r)=>{if(s){const i=b(r);t[i]={...n,details:{inputType:g.Axe},inputName:i,inputValue:s}}}),t}const E=.01;function H(e,t){const n=t[e.id],s=e.axes.map((i,a)=>{const o=(n==null?void 0:n.axesDeadZones[a])??E;return Math.abs(i)<o?0:i}),r=e.buttons.map((i,a)=>{const o=(n==null?void 0:n.axesDeadZones[a])??E,P=Math.abs(i.value)<o?0:i.value;return{...i,value:P}});return{axes:s,buttons:r}}function U(e){return Z(e,(t,n)=>({currentInputs:$(n),deviceDetails:n,deviceName:n.id,deviceKey:n.index,deviceType:u.Gamepad}))}function x(e){return y(e).map(s=>s.currentInputs).map(s=>y(s)).flat()}const C={deviceDetails:void 0,deviceKey:c.keyboard,deviceName:"keyboard",deviceType:u.Keyboard},f={deviceDetails:void 0,deviceKey:c.mouse,deviceName:"mouse",deviceType:u.Mouse};function m(){return(e,t)=>{var n;const s=(n=class extends R()(e){static constructIfDataDataCheckPasses(r,...i){const a=s.dataCheckCallback(...i);if(a)return new s({detail:{timestamp:r,data:a}})}},n.dataCheckCallback=t,n);return s}}function W(...[e,t]){return t}class X extends m()(d.AllDevicesUpdated,W){}function Y(...[e,t]){const n=x(t),s=e?x(e):[];if(!K(s,n)){const r=n.filter(a=>!s.find(o=>{o.inputName,a.inputName})),i=s.filter(a=>!n.find(o=>{o.inputName,a.inputName}));return{newInputs:r,removedInputs:i,allCurrentInputs:n}}}class Q extends m()(d.CurrentInputsChanged,Y){}function ee(...[e,t]){if(!e)return[];const n=p(e).filter(s=>!v(t,s));if(n.length)return n.map(s=>e[s]).filter(M)}class te extends m()(d.DevicesRemoved,ee){}function ne(...[e,t]){if(!e)return y(t);const n=p(t).filter(s=>!v(e,s));if(n.length)return n.map(s=>t[s]).filter(M)}class se extends m()(d.NewDevicesAdded,ne){}const A=[X,se,te,Q];A.reduce((e,t)=>(e[t.type]=t,e),{});class re extends F{constructor(t={}){super(),this.currentKeyboardInputs={},this.currentMouseInputs={},this.gamepadDeadZoneSettings={},this.loopIsRunning=!1,this.currentLoopIndex=-1,t.skipLoopStart||this.startPollingLoop(),t.gamepadDeadZoneSettings&&this.updateGamepadDeadZoneSettings(t.gamepadDeadZoneSettings),this.attachWindowListeners(t)}attachWindowListeners(t){window.addEventListener("keydown",n=>{const s=l(n.key);if(this.currentKeyboardInputs.hasOwnProperty(s))return;const r={deviceType:u.Keyboard,details:{keyboardEvent:n},deviceKey:c.keyboard,deviceName:C.deviceName,inputName:s,inputValue:1};this.currentKeyboardInputs[s]=r}),window.addEventListener("keyup",n=>{delete this.currentKeyboardInputs[l(n.key)]}),window.addEventListener("mousedown",n=>{const s=l(n.button);this.currentMouseInputs.hasOwnProperty(s)||(this.currentMouseInputs[s]={deviceType:u.Mouse,details:{mouseEvent:n},deviceName:f.deviceName,deviceKey:c.mouse,inputName:s,inputValue:1})}),window.addEventListener("mouseup",n=>{delete this.currentMouseInputs[l(n.button)]}),t.listenToMouseMovement&&window.addEventListener("mousemove",n=>{const s=b("x"),r=b("y");this.currentMouseInputs[s]={deviceType:u.Mouse,details:{mouseEvent:n},deviceName:f.deviceName,deviceKey:c.mouse,inputName:s,inputValue:n.clientX},this.currentMouseInputs[r]={deviceType:u.Mouse,details:{mouseEvent:n},deviceName:f.deviceName,deviceKey:c.mouse,inputName:r,inputValue:n.clientY}})}runPollingLoop(t,n){this.loopIsRunning&&this.currentLoopIndex===t&&(this.updateInputDevices(n),requestAnimationFrame(s=>{this.runPollingLoop(t,s)}))}fireEvents(t,n){A.forEach(s=>{const r=s.constructIfDataDataCheckPasses(t,this.lastReadInputDevices,n);r&&this.dispatchEvent(r)})}readAllInputDevices(){const t=B(this.gamepadDeadZoneSettings),n=U(t);return{[c.keyboard]:{...C,currentInputs:{...this.currentKeyboardInputs}},[c.mouse]:{...f,currentInputs:{...this.currentMouseInputs}},...n}}addEventListenerAndFireRightAway(...t){this.addEventListener(...t)}startPollingLoop(){this.loopIsRunning=!0,this.currentLoopIndex++,requestAnimationFrame(t=>{this.runPollingLoop(this.currentLoopIndex,t)})}pausePollingLoop(){this.loopIsRunning=!1}getLastPollResults(){return this.lastReadInputDevices}updateInputDevices(t=Date.now()){const n=this.readAllInputDevices();return this.fireEvents(t,n),this.lastReadInputDevices=n,n}updateGamepadDeadZoneSettings(t){this.gamepadDeadZoneSettings=t}}const h=new re({listenToMouseMovement:!0}),w=window.document.getElementById("device-names");h.addEventListener(d.CurrentInputsChanged,e=>{console.info("input changed:",e.detail.data)});h.addEventListener(d.DevicesRemoved,e=>{console.info("devices removed:",e.detail.data),e.detail.data.forEach(t=>{w.innerHTML=w.innerHTML.replace(String(t.deviceName)+"<br>","")})});h.addEventListener(d.NewDevicesAdded,e=>{console.info("new devices:",e.detail.data),e.detail.data.forEach(t=>{w.innerHTML+=String(t.deviceName)+"<br>"})});console.info({instance:h});
