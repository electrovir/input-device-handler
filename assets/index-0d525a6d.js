var J=Object.defineProperty;var U=(e,t,n)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var l=(e,t,n)=>(U(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const _=[(e,t)=>t in e,(e,t)=>t in e.constructor.prototype];function X(e,t){return e?_.some(n=>{try{return n(e,t)}catch{return!1}}):!1}function Y(e){let t;try{t=Reflect.ownKeys(e)}catch{}return t??[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}var O;(function(e){e.Upper="upper",e.Lower="lower"})(O||(O={}));var M;(function(e){e.FirstThenWait="first-then-wait",e.AfterWait="after-wait"})(M||(M={}));function Q(e){return e?e instanceof Error?e.message:X(e,"message")?String(e.message):String(e):""}function P(e){return!!e&&typeof e=="object"}function ee(){return globalThis.crypto?globalThis.crypto:require("crypto").webcrypto}ee();function te(e){return e===null?"null":Array.isArray(e)?"array":typeof e}function I(e,t){return te(e)===t}class ne extends Error{constructor(t){super(`Failed to compare objects using JSON.stringify: ${t}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"JsonStringifyError"})}}function T(e,t){return JSON.stringify(e)===JSON.stringify(t)}function F(e,t){try{if(e===t||T(e,t))return!0;if(P(e)&&P(t)){const n=Object.keys(e).sort(),s=Object.keys(t).sort();if(n.length||s.length)return T(n,s)?Y(e).every(i=>F(e[i],t[i])):!1}return T(e,t)}catch(n){throw new ne(Q(n))}}const re=[(e,t)=>t in e,(e,t)=>t in e.constructor.prototype];function g(e,t){return e?re.some(n=>{try{return n(e,t)}catch{return!1}}):!1}function y(e){let t;try{t=Reflect.ownKeys(e)}catch{}return t??[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function K(e){return y(e).map(t=>e[t])}function se(e){return Object.fromEntries(e)}function ie(e,t){return e.includes(t)}function b(e){return!!e}const oe={capitalizeFirstLetter:!1};function ae(e){return e.length?e[0].toUpperCase()+e.slice(1):""}function ue(e,t){return t.capitalizeFirstLetter?ae(e):e}function ce(e,t=oe){const n=e.toLowerCase();if(!n.length)return"";const s=n.replace(/^-+/,"").replace(/-{2,}/g,"-").replace(/-(?:.|$)/g,r=>{const i=r[1];return i?i.toUpperCase():""});return ue(s,t)}var G;(function(e){e.Upper="upper",e.Lower="lower"})(G||(G={}));var A;(function(e){e.FirstThenWait="first-then-wait",e.AfterWait="after-wait"})(A||(A={}));function le(e,t){let n=!1;const s=y(e).reduce((r,i)=>{const o=t(i,e[i],e);return o instanceof Promise&&(n=!0),{...r,[i]:o}},{});return n?new Promise(async(r,i)=>{try{await Promise.all(y(s).map(async o=>{const d=await s[o];s[o]=d})),r(s)}catch(o){i(o)}}):s}function de(){return globalThis.crypto?globalThis.crypto:require("crypto").webcrypto}de();const S={Gamepad1:"0",Gamepad2:"1",Gamepad3:"2",Gamepad4:"3"};function k(e){return ie(Object.values(S),e)}const pe={Mouse:"mouse",Keyboard:"keyboard"},c={...pe,...S};var a=(e=>(e.Keyboard="keyboard",e.Mouse="mouse",e.Gamepad="gamepad",e))(a||{}),L=(e=>(e.Button="button",e.Axe="axe",e))(L||{});function m(e){return`button-${e}`}function D(e){return`axe-${e}`}const fe=.01;function me({value:e,gamepadDeadZone:t,globalDeadZone:n}){const s=t??(n||fe);return Math.abs(e)>s?e:0}function C({gamepadInput:e,inputIndex:t,deadZones:n,globalDeadZone:s}){const r=I(e,"number"),i=r?D(t):m(t),o=r?e:e.value;return{inputName:i,value:me({value:o,gamepadDeadZone:n[i],globalDeadZone:s}),inputType:r?L.Axe:L.Button}}function ye({gamepad:e,deadZoneSettings:t,globalDeadZone:n}){const s=String(e.index);if(!k(s))throw new Error(`Tried to serialize gamepad with out-of-bounds index: '${e.index}'`);const r=t[e.id]||{},i=e.axes.map((u,p)=>C({gamepadInput:u,inputIndex:p,deadZones:r,globalDeadZone:n})),o=e.buttons.map((u,p)=>C({deadZones:r,gamepadInput:u,globalDeadZone:n,inputIndex:p})),d=se([...o,...i].map(u=>[u.inputName,u]));return{axes:i,buttons:o,isConnected:e.connected,gamepadName:e.id,deviceKey:s,mapping:e.mapping,serialized:!0,timestamp:e.timestamp,inputsByName:d}}const v=window.navigator;function ve({deadZoneSettings:e,globalDeadZone:t}){return Array.from(g(v,"webkitGetGamepads")?v.webkitGetGamepads():g(v,"getGamepads")?v.getGamepads():[]).filter(n=>!!n).map(n=>ye({gamepad:n,deadZoneSettings:e,globalDeadZone:t}))}function he({deadZoneSettings:e,globalDeadZone:t}){return ve({deadZoneSettings:e,globalDeadZone:t}).reduce((r,i)=>{const o=i.deviceKey;return k(o)?(r[o]=i,r):(console.warn(`ignoring gamepad index '${o}'`),r)},{})}function ge(e){const t={},n={deviceKey:e.deviceKey,deviceName:e.gamepadName,deviceType:a.Gamepad};return Object.values(e.inputsByName).forEach(s=>{s.value&&(t[s.inputName]={...n,details:s,inputName:s.inputName,inputValue:s.value})}),t}function be(e){return le(e,(t,n)=>({currentInputs:ge(n),deviceDetails:n,deviceName:n.gamepadName,deviceKey:n.deviceKey,deviceType:a.Gamepad}))}function j(e){return K(e).map(s=>s==null?void 0:s.currentInputs).filter(b).map(s=>K(s)).flat()}var we=globalThis&&globalThis.__setFunctionName||function(e,t,n){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};function Ne(){return class extends Event{constructor(t,n){super(t,n),Object.defineProperty(this,"detail",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.detail=n.detail}}}const Te=globalThis.CustomEvent||Ne();function Ie(){function e(t){var n;return n=class extends Te{constructor(r){super(t,r)}},we(n,"TypedEventConstructor"),Object.defineProperty(n,"type",{enumerable:!0,configurable:!0,writable:!0,value:t}),n}return e}globalThis&&globalThis.__setFunctionName;function Ke(e){let t;try{t=Reflect.ownKeys(e)}catch{}return t??[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function x(e){return Ke(e).map(t=>e[t])}var Z;(function(e){e.Upper="upper",e.Lower="lower"})(Z||(Z={}));var R;(function(e){e.FirstThenWait="first-then-wait",e.AfterWait="after-wait"})(R||(R={}));function Le(){return globalThis.crypto?globalThis.crypto:require("crypto").webcrypto}Le();class De{constructor(){Object.defineProperty(this,"listeners",{enumerable:!0,configurable:!0,writable:!0,value:{}})}getListenerCount(){return x(this.listeners).map(n=>(n==null?void 0:n.size)||0).reduce((n,s)=>n+s,0)}listen(t,n,s={}){const r=this.listeners,i=I(t,"string")?t:t.type;function o(){var u;return((u=r[i])==null?void 0:u.delete(n))||!1}function d(u,p){s.once&&o(),n(u,p)}return r[i]||(r[i]=new Map),r[i].set(n,{listener:d,removeListener:o}),o}removeListener(t,n){const s=I(t,"string")?t:t.type,r=this.listeners[s];if(!r)return!1;const i=r.get(n);return i?i.removeListener():!1}dispatch(t){const n=this.listeners[t.type],s=(n==null?void 0:n.size)||0;return n==null||n.forEach(r=>{r.listener(t,r.removeListener)}),s}removeAllListeners(){const n=x(this.listeners).reduce((s,r)=>{const i=(r==null?void 0:r.size)||0;return r==null||r.clear(),s+i},0);return this.listeners={},n}destroy(){this.removeAllListeners()}}function Ee(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function f(e,t,n){return Ee(globalThis,e,t,n)}function w(){return(e,t)=>{var r;const n=ce(e,{capitalizeFirstLetter:!0}),s=(r=class extends Ie()(e){constructor(){super(...arguments);l(this,"eventType",e)}static constructIfDataIsNew(o,...d){const u=s.getNewData(...d);if(u)return new s({detail:{timestamp:o,inputs:u}})}},l(r,"getNewData",t),r);return Object.defineProperty(s,"name",{value:n,writable:!0}),s}}function V(e,t){return e.deviceKey===t.deviceKey&&e.inputName===t.inputName&&e.inputName===t.inputName&&e.inputValue===t.inputValue}function Oe(...[e,t]){const n=j(t),s=e?j(e):[];if(!F(s,n)){const r=n.filter(o=>!s.find(d=>V(d,o))),i=s.filter(o=>!n.find(d=>V(d,o)));return{newInputs:r,removedInputs:i,allCurrentInputs:n}}}const q=w()("current-inputs-changed",Oe);function Me(...[e,t]){if(!e)return[];const n=y(e).filter(s=>!g(t,s));if(n.length)return n.map(s=>e[s]).filter(b)}const B=w()("devices-removed",Me);function Pe(...[e,t]){if(!e)return K(t).filter(b);const n=y(t).filter(s=>!g(e,s));if(n.length)return n.map(s=>t[s]).filter(b)}const W=w()("new-devices-added",Pe),$={deviceDetails:void 0,deviceKey:c.Keyboard,deviceName:"keyboard",deviceType:a.Keyboard},h={deviceDetails:void 0,deviceKey:c.Mouse,deviceName:"mouse",deviceType:a.Mouse};c.Gamepad1+"",a.Gamepad,c.Gamepad2+"",a.Gamepad,c.Gamepad3+"",a.Gamepad,c.Gamepad4+"",a.Gamepad,c.Keyboard+"",a.Keyboard,c.Mouse+"",a.Mouse;function Ge(...[e,t]){return t}const Ae=w()("all-devices-updated",Ge),H=[Ae,W,B,q];Object.fromEntries(H.map(e=>[e.type,e]));const z="code";class Ce extends De{constructor(n={}){super();l(this,"currentKeyboardInputs",{});l(this,"currentMouseInputs",{});l(this,"gamepadDeadZoneSettings",{});l(this,"lastReadInputDevices");l(this,"loopIsRunning",!1);l(this,"globalDeadZone",0);l(this,"removeGlobalListeners",()=>{});l(this,"currentLoopIndex",-1);l(this,"lastEventDetails",{});n.gamepadDeadZoneSettings&&this.updateGamepadDeadZoneSettings(n.gamepadDeadZoneSettings),n.globalDeadZone&&(this.globalDeadZone=n.globalDeadZone),this.attachWindowListeners(n),this.readAllDevices(),n.startLoopImmediately&&this.startPollingLoop()}attachWindowListeners(n){const s=[f("keydown",r=>{const i=m(r[z]);if(this.currentKeyboardInputs.hasOwnProperty(i))return;const o={deviceType:a.Keyboard,details:{keyboardEvent:r},deviceKey:c.Keyboard,deviceName:$.deviceName,inputName:i,inputValue:1};this.currentKeyboardInputs[i]=o}),f("keyup",r=>{delete this.currentKeyboardInputs[m(r[z])]}),f("mousedown",r=>{const i=m(r.button);this.currentMouseInputs.hasOwnProperty(i)||(this.currentMouseInputs[i]={deviceType:a.Mouse,details:{mouseEvent:r},deviceName:h.deviceName,deviceKey:c.Mouse,inputName:i,inputValue:1})}),f("mouseup",r=>{delete this.currentMouseInputs[m(r.button)]}),n.disableMouseMovement?void 0:f("mousemove",r=>{const i=D("x"),o=D("y");this.currentMouseInputs[i]={deviceType:a.Mouse,details:{mouseEvent:r},deviceName:h.deviceName,deviceKey:c.Mouse,inputName:i,inputValue:r.clientX},this.currentMouseInputs[o]={deviceType:a.Mouse,details:{mouseEvent:r},deviceName:h.deviceName,deviceKey:c.Mouse,inputName:o,inputValue:r.clientY}})];this.removeGlobalListeners=()=>{s.forEach(r=>r==null?void 0:r())}}runPollingLoop(n,s){this.loopIsRunning&&this.currentLoopIndex===n&&(this.readAllDevices(this.gamepadDeadZoneSettings,s),requestAnimationFrame(r=>{this.runPollingLoop(n,r)}))}fireEvents(n,s,r){H.forEach(i=>{const o=i.constructIfDataIsNew(n,s,r);o&&(this.lastEventDetails[o.type]={constructor:i,constructorInputs:[n,s,r]},this.dispatch(o))})}getCurrentDeviceValues(n,s){const r=he({deadZoneSettings:n,globalDeadZone:s}),i=be(r);return{[c.Keyboard]:{...$,currentInputs:{...this.currentKeyboardInputs}},[c.Mouse]:{...h,currentInputs:{...this.currentMouseInputs}},...i}}startPollingLoop(){this.loopIsRunning||(this.loopIsRunning=!0,this.currentLoopIndex++,requestAnimationFrame(n=>{this.runPollingLoop(this.currentLoopIndex,n)}))}pausePollingLoop(){this.loopIsRunning&&(this.loopIsRunning=!1)}getLastPollResults(){return this.lastReadInputDevices}readAllDevices(n=this.gamepadDeadZoneSettings,s=performance.now(),r=this.globalDeadZone){const i=this.getCurrentDeviceValues(n,r),o=this.lastReadInputDevices;return this.lastReadInputDevices=i,this.fireEvents(s,o,i),i}updateGamepadDeadZoneSettings(n){this.gamepadDeadZoneSettings=n}}const N=new Ce({startLoopImmediately:!0}),E=window.document.getElementById("device-names");N.listen(q,e=>{console.info("input changed:",e.detail.inputs)});N.listen(B,e=>{console.info("devices removed:",e.detail.inputs),e.detail.inputs.forEach(t=>{E.innerHTML=E.innerHTML.replace(String(t.deviceName)+"<br>","")})});N.listen(W,e=>{console.info("new devices:",e.detail.inputs),e.detail.inputs.forEach(t=>{E.innerHTML+=String(t.deviceName)+"<br>"})});console.info({instance:N});
